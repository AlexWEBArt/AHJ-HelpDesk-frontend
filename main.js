(()=>{"use strict";var e="";const t=e+"assets/253f7b15dd6eb9ac37984ada287333f9.jpg";class n{constructor(){this._tooltips=[]}showTooltip(e,t){const n=document.createElement("DIV");n.classList.add("form-error"),n.textContent=e;const s=performance.now();this._tooltips.push({id:s,element:n}),document.body.appendChild(n);const{right:o,top:r}=t.getBoundingClientRect();return n.style.left=`${o+5}px`,n.style.top=r+t.offsetHeight/2-n.offsetHeight/2+"px",s}removeTooltip(e){const t=this._tooltips.find((t=>t.id===e));t&&t.element.remove(),this._tooltips=this._tooltips.filter((t=>t.id!==e))}removeAllTooltip(){this._tooltips.forEach((e=>e.element.remove())),this._tooltips=[]}}const s=e+"assets/0423e9054bbc9277b0347f38f82b6921.png";class o{constructor(e){this.container=null,this.input=document.querySelector(".input_name"),this.textArea=document.querySelector(".textarea_description"),this.update=!1,this.updateTicket=null,this.tooltipFactory=new n,this.storage=e,this.data=this.storage.load()}openPopup(e){if(!(e instanceof HTMLElement))throw new Error("container is not HTMLElement");if(this.container=e,!document.querySelector(".popup_container")){const e=document.createElement("DIV"),t=document.createElement("FORM"),n=document.createElement("DIV"),s=document.createElement("P"),r=document.createElement("INPUT"),a=document.createElement("DIV"),d=document.createElement("P"),c=document.createElement("TEXTAREA"),i=document.createElement("DIV"),l=document.createElement("BUTTON"),p=document.createElement("BUTTON");t.classList.add("form_popup"),t.setAttribute("novalidate",!0),t.method="POST",t.action="http://localhost:7070",e.classList.add("popup_container"),n.classList.add("popup-control"),a.classList.add("popup-control"),s.classList.add("Input_text"),s.textContent="Краткое описание",d.classList.add("Input_text"),d.textContent="Подробное описание",r.classList.add("input_name"),r.setAttribute("required",!0),r.name="name",c.classList.add("textarea_description"),c.setAttribute("required",!0),c.name="description",i.classList.add("popup-btn"),l.classList.add("btn"),l.classList.add("btn_cancel"),l.textContent="Отмена",p.classList.add("btn"),p.classList.add("btn_save"),p.textContent="Сохранить",document.body.appendChild(e),e.prepend(t),i.prepend(l),i.prepend(p),t.prepend(i),a.prepend(c),a.prepend(d),t.prepend(a),n.prepend(r),n.prepend(s),t.prepend(n),l.addEventListener("click",(e=>{e.preventDefault(),this.updateTicket=null,this.update=!1,o.closePopup()}));let u=[];const m=(e,t)=>{u.push({name:t.name,id:this.tooltipFactory.showTooltip(e,t)})};t.addEventListener("submit",(e=>{if(e.preventDefault(),u.forEach((e=>this.tooltipFactory.removeTooltip(e.id))),u=[],t.checkValidity())this.update||(this.saveInputNote(),o.closePopup()),this.update&&(this.updateNote(),o.closePopup());else{const{elements:e}=t;[...e].forEach((e=>{const t=o.getError(e);t&&m(t,e)}))}}));const h=e=>{const t=e.target,n=o.getError(t);if(n)m(n,t);else{const e=u.find((e=>e.name===t.name));e&&this.tooltipFactory.removeTooltip(e.id)}t.removeEventListener("blur",h)};Array.from(t.elements).forEach((e=>e.addEventListener("focus",(()=>{e.addEventListener("blur",h)}))))}}renderingNote(e){const t=document.querySelector(".list_editor_container"),n=document.createElement("UL"),o=document.createElement("LI"),r=document.createElement("DIV"),a=document.createElement("LI"),d=document.createElement("P"),c=document.createElement("P"),i=document.createElement("LI"),l=document.createElement("P"),p=document.createElement("LI"),u=document.createElement("IMG"),m=document.createElement("DIV");n.classList.add("list_editor"),n.setAttribute("id",e.id),o.classList.add("status"),r.classList.add("ticket_status"),r.setAttribute("status",e.status),"true"===r.getAttribute("status")&&(r.textContent="✓"),a.classList.add("name"),d.classList.add("name_title"),c.classList.add("description"),c.classList.add("display_none"),i.classList.add("created"),l.classList.add("date_of_creation"),p.classList.add("action_edit"),u.classList.add("btn_update_img"),m.classList.add("btn_delete"),d.textContent=e.name,l.textContent=e.created,u.src=s,m.textContent="x",t.appendChild(n),p.prepend(m),p.prepend(u),n.prepend(p),i.prepend(l),n.prepend(i),a.prepend(c),a.prepend(d),n.prepend(a),o.prepend(r),n.prepend(o),u.addEventListener("click",(e=>{console.log(e),this.updateTicket=u.closest(".list_editor"),this.preUpdateNote(this.updateTicket),this.activEvent=e.target})),m.addEventListener("click",(()=>{console.log(m.closest(".list_editor")),function(e){const t=document.createElement("DIV"),n=document.createElement("DIV"),s=document.createElement("H1"),o=document.createElement("P"),r=document.createElement("DIV"),a=document.createElement("BUTTON"),d=document.createElement("BUTTON");t.classList.add("popup_container"),o.classList.add("Input_text"),s.textContent="Удалить тикет",o.textContent="Вы уверены, что хотите удалить тикет? Это действие необратимо.",r.classList.add("popup-btn"),a.classList.add("btn"),a.classList.add("btn_cancel"),a.textContent="Отмена",d.classList.add("btn"),d.textContent="Ok",document.body.appendChild(t),t.prepend(n),r.prepend(d),r.prepend(a),n.prepend(r),n.prepend(o),n.prepend(s),a.addEventListener("click",(()=>document.querySelector(".popup_container").remove())),d.addEventListener("click",(()=>{const t=new XMLHttpRequest,n=e.getAttribute("id");t.open("DELETE",`https://helpdesk-backend-rxb4.onrender.com/deleteTicket/?id=${n}`),t.setRequestHeader("Content-type","application/x-www-form-urlencoded"),t.send(),t.addEventListener("load",(()=>{console.log(JSON.parse(t.responseText))})),e.remove(),document.querySelector(".popup_container").remove()}))}(m.closest(".list_editor"))})),r.addEventListener("click",(()=>{const e=new XMLHttpRequest;e.open("POST","https://helpdesk-backend-rxb4.onrender.com/statusChanged"),e.send(r.closest(".list_editor").getAttribute("id")),""===r.textContent?(r.textContent="✓",r.setAttribute("status","true")):(r.textContent="",r.setAttribute("status","false"))})),a.addEventListener("click",(()=>{if(c.classList.contains("display_none")){const e=new XMLHttpRequest;e.open("POST","https://helpdesk-backend-rxb4.onrender.com/ticketById"),console.log(a.closest(".list_editor").getAttribute("id")),e.send(a.closest(".list_editor").getAttribute("id")),e.addEventListener("load",(()=>{const t=JSON.parse(e.responseText);c.textContent=t})),c.classList.remove("display_none")}else c.classList.add("display_none")}))}static getError(e){const t=Object.keys(ValidityState.prototype).find((t=>e.name?"valid"===t?null:e.validity[t]:null));return t?{name:{valueMissing:'Заполните, пожалуйста, поле "Краткое описание"'},description:{valueMissing:'Заполните, пожалуйста, поле "Подробное описание"'}}[e.name][t]:null}static getCreationDate(){const e=new Date;let t=e.getHours(),n=e.getMinutes(),s=e.getDate(),o=e.getMonth()+1;return t<10&&(t=`0${t}`),n<10&&(n=`0${n}`),s<10&&(s=`0${s}`),o<10&&(o=`0${o}`),`${s}.${o}.${e.getFullYear()} ${t}:${n}`}static closePopup(){document.querySelectorAll(".form-error").forEach((e=>e.remove())),document.querySelector(".popup_container").remove()}saveInputNote(){const e=document.querySelector(".input_name"),t=document.querySelector(".textarea_description");null===this.data&&(this.data={});const n={name:e.value,description:t.value},s=new XMLHttpRequest;s.onreadystatechange=function(){4===s.readyState&&console.log(s.responseText)},s.open("PUT","https://helpdesk-backend-rxb4.onrender.com/createNewTicket"),s.send(JSON.stringify(n)),s.addEventListener("load",(()=>{if(s.status>=200&&s.status<300)try{const e=JSON.parse(s.responseText);this.renderingNote(e)}catch(e){console.error(e)}}))}preUpdateNote(e){this.openPopup(document.querySelector(".app_container"));const t=e.closest(".list_editor").getAttribute("id"),n=document.querySelector(".input_name"),s=document.querySelector(".textarea_description");n.value=e.querySelector(".name_title").textContent;const o=new XMLHttpRequest;o.onreadystatechange=function(){4===o.readyState&&console.log(o.responseText)},o.open("POST","https://helpdesk-backend-rxb4.onrender.com/ticketById"),o.send(t),o.addEventListener("load",(()=>{s.value=JSON.parse(o.responseText)})),this.update=!0}updateNote(){const e=this.updateTicket.closest(".list_editor").getAttribute("id"),t=document.querySelector(".input_name"),n=document.querySelector(".textarea_description"),s=this.updateTicket.closest(".list_editor").querySelector(".name_title"),o=this.updateTicket.closest(".list_editor").querySelector(".description"),r=new XMLHttpRequest,a={id:e,name:t.value,description:n.value};r.onreadystatechange=function(){4===r.readyState&&console.log(r.responseText)},r.open("PATCH","https://helpdesk-backend-rxb4.onrender.com/updateTicket"),r.send(JSON.stringify(a)),r.addEventListener("load",(()=>{s.textContent=JSON.parse(r.responseText).name,o.textContent=JSON.parse(r.responseText).description})),this.update=!1}}const r=new class{constructor(){this.storage=localStorage}save(e){this.storage.setItem("data",JSON.stringify(e))}load(){try{return JSON.parse(this.storage.getItem("data"))}catch(e){throw new Error("Invalid data")}}statusChange(e,t){const n=this.load();for(const s in n)s===e&&(n[s].status=t);this.save(n)}removeTicket(e){const t=this.load();for(const n in t)n===e&&delete t[n];this.save(t)}};document.querySelector("body").style.backgroundImage=`url(${t})`;const a=new o(r),d=document.querySelector(".app_container"),c=document.querySelector(".btn_add"),i=new XMLHttpRequest;i.open("GET","https://helpdesk-backend-rxb4.onrender.com/allTickets"),i.withCredentials=!1,i.send(),i.addEventListener("load",(()=>{if(i.status>=200&&i.status<300)try{const e=JSON.parse(i.responseText);if(null!==e)for(const t in e)Object.prototype.hasOwnProperty.call(e,"key")||a.renderingNote(e[t])}catch(e){console.error(e)}})),c.addEventListener("click",(e=>{e.preventDefault(),a.openPopup(d)})),console.log("app.js is bunled")})();
//# sourceMappingURL=main.js.map